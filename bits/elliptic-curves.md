# üñç –≠–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–∏–µ –∫—Ä–∏–≤—ã–µ

–≠–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–∏–µ –∫—Ä–∏–≤—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ–≤—Å–µ–º–µ—Å—Ç–Ω–æ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫—Ä–∏–ø—Ç–æ—Å–∏—Å—Ç–µ–º–∞—Ö. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏ Bitcoin –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫—Ä–∏–≤–∞—è [secp256k1](https://en.bitcoin.it/wiki/Secp256k1).

–ù–∞—Å –±—É–¥–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–∏—Ö –∫—Ä–∏–≤—ã—Ö –≤ –∫–æ–Ω–∫—É—Ä—Å–∞—Ö —Ñ–æ—Ä–º–∞—Ç–∞ [CTF](https://en.wikipedia.org/wiki/Capture_the_flag#Computer_security), –≥–¥–µ –∫—Ä–∏–ø—Ç–æ—Å–∏—Å—Ç–µ–º–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —É—è–∑–≤–∏–º–æ—Å—Ç–∏, –∞ —É—Å–ø–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, —Å–º–æ–∂–µ—Ç –ª–∏ –æ–Ω –Ω–∞–π—Ç–∏ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —ç–∫—Å–ø–ª—É–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —ç—Ç—É –±—Ä–µ—à—å –≤ –∑–∞—â–∏—Ç–µ.

{% hint style="info" %}
–ö—Ä–∏–ø—Ç–æ—Å–∏—Å—Ç–µ–º–∞ ‚Äî —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç–æ–¥–æ–≤ –∏ —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–µ–π –∏–º –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —É—Å–ª—É–≥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –ö—Ä–∏–ø—Ç–æ—Å–∏—Å—Ç–µ–º–∞ —Ç–∞–∫–∂–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π **—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è**.
{% endhint %}

## –¢–µ–æ—Ä–∏—è, –ø–æ—Ç—Ä–µ–±–Ω–∞—è –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∏ —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á

### –ö–æ–Ω–µ—á–Ω—ã–µ –ø–æ–ª—è

üñç

### –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞

üñç

### –≠–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–∏–µ –∫—Ä–∏–≤—ã–µ

üñç

### –§–æ—Ä–º–∞—Ç—ã –∫–ª—é—á–µ–π

üñç

## –ê—Ç–∞–∫–∏ –Ω–∞ –∫—Ä–∏–ø—Ç–æ—Å–∏—Å—Ç–µ–º—ã —Å —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–∏–º–∏ –∫—Ä–∏–≤—ã–º–∏

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–≥–æ –º–µ—Å—Ç–∞

–î–ª—è —Ä–∞–±–æ—Ç—ã –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ [Node.js](../wastelands/getting-started.md#setting-up-node-js) –∏ —è–∑—ã–∫ [Python](../marshes/tg-button-autoclicking.md#installing-python).

–ü–æ–ª–µ–∑–Ω–æ –±—É–¥–µ—Ç –∏–º–µ—Ç—å –ø–æ–¥ —Ä—É–∫–æ–π –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ [SageMath](https://www.sagemath.org/download.html). –ï—Å–ª–∏ –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SageMath, –º–æ–∂–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –æ–Ω–ª–∞–π–Ω-—è—á–µ–π–∫–æ–π –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π:

{% embed url="https://sagecell.sagemath.org/" %}

## –ó–∞–¥–∞—á–∞ ‚Ññ1. Invalid curve attack

Invalid curve attack - –∞—Ç–∞–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫—Ä–∏–≤–æ–π. –ú–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –≤ —Ç–æ–º —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ç–æ—á–∫–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –Ω–∞—Å—Ç–æ—è—â–µ–π –∫—Ä–∏–≤–æ–π, –∑–∞—è–≤–ª–µ–Ω–Ω–æ–π –≤ –∫—Ä–∏–ø—Ç–æ—Å–∏—Å—Ç–µ–º–µ.

–î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∞—Ç–∞–∫–∏ –ø–æ–ø—Ä–æ–±—É–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ \(—Å —É–ø—Ä–æ—â–µ–Ω–∏—è–º–∏\) 3-—é –∑–∞–¥–∞—á—É –∏–∑ NeoQuest 2021. –í–æ—Ç —É—Å–ª–æ–≤–∏—è:

```python
Encryption scheme: ECIES.
Elliptic Curve: secp256r1.

p = 0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff
a = p - 3
b = 0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b
n = 0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551
P = (0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296, 
    0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5)
    
MAC for tag computation: HMAC-SHA256.
Block Cipher: AES-CTR.
Function for symmetric keys deriving (aes_key, mac_key): 
  SHA512(str(K.x).encode("utf-8")),where K.x - x-coordinate of point K
Public Key: 
Q = (0x58cd232129f77e18a4e0ae06c3f298d41ca35abb40a03997b1ba226104fb6722, 
    0x0d60be09cb87d89d3e486c3119589825160c59f037c52c106b4d23e7d0e8edab)
    
/encrypt
    Encrypt your message with ECIES scheme using server's public key.
		
		POST PARAMETERS
		*file: file to encrypt 
		
		RETURN encrypted file in format: 
		    * R (point in uncompressed form): 0x04+x+y  #1+32*2 bytes
		    * tag: HMAC-SHA256 (ciphertext)  # 32 bytes
		    * ciphertext: 8 prefix bytes + encrypted data

/decrypt
		Decrypt your message with ECIES scheme using server's secret key.
		
		POST PARAMETERS
		*file: file to decrypt in format: R (point in uncompressed form) + tag + 
		    ciphertext (8 prefix bytes + encrypted data)
		
		RETURN: decrypted file				
```

–ù–∞–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω —Å–µ—Ä–≤–µ—Ä —Å –¥–≤—É–º—è –º–µ—Ç–æ–¥–∞–º–∏ `encrypt` –∏ `decrypt`. –ù—É–∂–Ω–æ –æ—Ç—ã—Å–∫–∞—Ç—å –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á —Å–µ—Ä–≤–µ—Ä–∞. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –ø–æ–º–æ—â—å—é –∞–ª–≥–æ—Ä–∏—Ç–º–∞ [ECIES](https://ru.wikipedia.org/wiki/ECIES), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–¥—ë–∂–Ω–∞—è —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–∞—è –∫—Ä–∏–≤–∞—è **`secp256r1`**, —Ç–∞–∫–∂–µ –∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–∞–∫ **`prime256v1`**. –í—Å–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∫—Ä–∏–≤–æ–π –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ —Å—Å—ã–ª–∫–µ:

{% embed url="https://neuromancer.sk/std/secg/secp256r1" %}

–ù–∞–º –∑–∞—Ä–∞–Ω–µ–µ –¥–∞–Ω –ø–æ—Ä—è–¥–æ–∫ –∫—Ä–∏–≤–æ–π `n`, –Ω–æ –º—ã –º–æ–∂–µ–º –≤—ã—á–∏—Å–ª–∏—Ç—å –µ–≥–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å –ø–æ–º–æ—â—å—é SageMath:

{% code title="https://sagecell.sagemath.org/" %}
```python
p = 0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff
a = p - 3
b = 0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b
n = 0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551
E = EllipticCurve(GF(p), [a, b])

print (E.order().hex())
print (E.order() == n)

# –ë—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω–æ:

# ffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551
# True
```
{% endcode %}

–ö–æ–¥ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω, –ø–æ—ç—Ç–æ–º—É –Ω–∞–ø–∏—à–µ–º –ø–æ–¥–æ–±–Ω—ã–π –Ω–∞ Node.js. –°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª `ecies.mjs`,  –∞–ª–≥–æ—Ä–∏—Ç–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Å–ª–µ–¥—É—é—â–∏–π:

#### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è  –ø–∞—Ä—ã –∫–ª—é—á–µ–π ECDH –∏ –æ–±—â–µ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞ `K`

–ü–∞—Ä–∞ –∫–ª—é—á–µ–π ECDH \(Elliptic Curve Diffie-Hellman\) - —ç—Ñ–µ–º–µ—Ä–Ω—ã–π \(–ø–æ—Ç–æ–º—É —á—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –Ω–æ–≤–æ–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–∏\) –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á `R` \(—Ç–æ—á–∫–∞ –Ω–∞ –∫—Ä–∏–≤–æ–π **`secp256r1`**\) –∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á \("–±–æ–ª—å—à–æ–µ" —á–∏—Å–ª–æ\). –ü–µ—Ä–≤—ã–π –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤—Ç–æ—Ä–æ–π —Å—Ç–æ—Ä–æ–Ω–µ \(–≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –≤ –æ—Ç–≤–µ—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞ –≤ –º–µ—Ç–æ–¥–µ `encrypt`\), –∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –Ω—É–∂–µ–Ω –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –æ–±—â–µ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞ `K`:

–û–±—â–∏–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á `K` –Ω—É–∂–µ–Ω –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –∑–∞—à–∏—Ñ—Ä–æ–≤—ã–≤–∞—Ç—å –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è, –ø–µ—Ä–µ–¥–∞—é—â–∏–µ—Å—è –º–µ–∂–¥—É —Å—Ç–æ—Ä–æ–Ω–∞–º–∏ –ø–æ –Ω–µ–∑–∞—â–∏—â–µ–Ω–Ω–æ–º—É –∫–∞–Ω–∞–ª—É —Å–≤—è–∑–∏. –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–±—â–µ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Ç–æ–∫–æ–ª –î–∏—Ñ—Ñ–∏ ‚Äî –•–µ–ª–ª–º–∞–Ω–∞, [—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –≤ Node.js](https://nodejs.org/dist/latest-v15.x/docs/api/crypto.html#crypto_class_ecdh).

–û–±—â–∏–π —Å–µ–∫—Ä–µ—Ç –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–∞–∫ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á. –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ –ø–∞—Ä—ã –∫–ª—é—á–µ–π —É –¥–≤—É—Ö —Å—Ç–æ—Ä–æ–Ω –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ —Ä–∞–∑–Ω—ã–µ, –æ–±—â–∏–π —Å–µ–∫—Ä–µ—Ç –±—É–¥–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º \(–Ω–∞ —Ç–æ –æ–Ω –∏ –Ω–∞–∑–≤–∞–Ω –æ–±—â–∏–º\).

#### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏ –∏–º–∏—Ç–æ–≤—Å—Ç–∞–≤–∫–∏ —Ñ—É–Ω–∫—Ü–∏–µ–π KDF

KDF \(Key Derivation Function\) - —Ñ—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ \(–∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–ª—é—á–µ–π\). –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –æ–±—â–∏–π —Å–µ–∫—Ä–µ—Ç `K`, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–º —ç—Ç–∞–ø–µ –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É –î–∏—Ñ—Ñ–∏ ‚Äî –•–µ–ª–ª–º–∞–Ω–∞, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞–µ—Ç—Å—è –≤ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á `Kenc` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∞–ª–≥–æ—Ä–∏—Ç–º–µ —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–≥–æ –±–ª–æ—á–Ω–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è AES-[CTR ](https://ru.wikipedia.org/wiki/%D0%A0%D0%B5%D0%B6%D0%B8%D0%BC_%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F#Counter_mode_%28CTR%29)\(—Å–º. —É—Å–ª–æ–≤–∏—è –∑–∞–¥–∞—á–∏\):

$$
KDF(K.x) = K_{enc} || K_{mac}
$$

–ü–æ —É—Å–ª–æ–≤–∏—è–º –∑–∞–¥–∞—á–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `x`-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ –æ–±—â–µ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞, –∞ –≤ –∫–∞—á–µ—Å—Ç–≤–µ KDF –≤—ã—Å—Ç—É–ø–∞–µ—Ç —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏—è [SHA-512](https://ru.wikipedia.org/wiki/SHA-2). –°–∏–º–≤–æ–ª \|\| –≤ —Ñ–æ—Ä–º—É–ª–µ –æ–∑–Ω–∞—á–∞–µ—Ç –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—é \(—Å–∫–ª–µ–π–∫—É\) –∏–∑ –¥–≤—É—Ö –ø–æ–ª–æ–≤–∏–Ω–æ–∫. `Kenc` - –∫–ª—é—á —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ AES-CTR. `Kmac` - –∫–ª—é—á –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è [–∏–º–∏—Ç–æ–≤—Å—Ç–∞–≤–∫–æ–π ](https://ru.wikipedia.org/wiki/%D0%98%D0%BC%D0%B8%D1%82%D0%BE%D0%B2%D1%81%D1%82%D0%B0%D0%B2%D0%BA%D0%B0)\(`tag`\). –ò–º–∏—Ç–æ–≤—Å—Ç–∞–≤–∫–∞ –Ω—É–∂–Ω–∞ –¥–ª—è –∑–∞—â–∏—Ç—ã –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç —Ñ–∞–ª—å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏.

#### –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–ª—é—á–æ–º `Kenc`

–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –º—ã –ø–æ–ª—É—á–∞–µ–º —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É AES-CTR. –®–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç - —ç—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

#### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–∏—Ç–æ–≤—Å—Ç–∞–≤–∫–∏ `tag` –∫–ª—é—á–æ–º `Kmac`

–ò–º–∏—Ç–æ–≤—Å—Ç–∞–≤–∫–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ HMAC-SHA256 –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —É—Å–ª–æ–≤–∏–µ–º –∑–∞–¥–∞—á–∏.

#### –í–æ–∑–≤—Ä–∞—Ç –∑–Ω–∞—á–µ–Ω–∏—è

–°–µ—Ä–≤–µ—Ä –æ—Ç–¥–∞—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –≤–∏–¥–µ —Å–∫–ª–µ–π–∫–∏ —ç—Ñ–µ–º–µ—Ä–Ω–æ–≥–æ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ `R`, –∏–º–∏—Ç–æ–≤—Å—Ç–∞–≤–∫–∏ `tag` –∏ —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç–∞ \(–∫–æ—Ç–æ—Ä—ã–π –ø–æ —É—Å–ª–æ–≤–∏—é –∑–∞–¥–∞—á–∏ –ø—Ä–µ–¥–≤–∞—Ä—è–µ—Ç—Å—è 8 —Å–ª—É—á–∞–π–Ω—ã–º–∏ –ø—Ä–µ—Ñ–∏–∫—Å–Ω—ã–º–∏ –±–∞–π—Ç–∞–º–∏\).

{% hint style="info" %}
–í –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ –ø—Ä–µ—Ñ–∏–∫—Å–Ω—ã–µ –±–∞–π—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–µ –±—É–¥—É—Ç.
{% endhint %}

### –ö–æ–¥ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –º–µ—Ç–æ–¥–∞ `/encrypt`

{% hint style="info" %}
–ú–µ—Ç–æ–¥ —à–∏—Ñ—Ä—É–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—É–±–ª–∏—á–Ω—ã–º –∫–ª—é—á–æ–º —Å–µ—Ä–≤–µ—Ä–∞ `Q`.

–°—Ç–æ–∏—Ç —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ –º–µ—Ç–æ–¥ `encrypt` –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∞—Ç–∞–∫—É. –û–Ω –ø—Ä–∏–≤–µ–¥–µ–Ω –≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö. –¢–∞–∫–∂–µ –æ–Ω –º–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤, —á—Ç–æ–±—ã –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —à–∏—Ñ—Ä—ã.
{% endhint %}

{% hint style="danger" %}
–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á:

`993913066650857197989941547339524640`

–ò–ª–∏ –≤  —à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç–µ—Ä–∏—á–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ —Å—á–∏—Å–ª–µ–Ω–∏—è:

`bf6bb29560b6db07ac53849526aa20`
{% endhint %}

–î–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á, —É–º–Ω–æ–∂–µ–Ω–Ω—ã–π –Ω–∞ —Ç–æ—á–∫—É-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–æ–π –∫—Ä–∏–≤–æ–π `P`, –¥–∞–µ—Ç –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á `Q` \(—Ç–∞–∫–∂–µ —Ç–æ—á–∫–∞ –Ω–∞ –∫—Ä–∏–≤–æ–π\):

{% code title="https://sagecell.sagemath.org/" %}
```python
p = 0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff
a = p - 3
b = 0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b
n = 0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551
E = EllipticCurve(GF(p), [a, b])

Px = 0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296
Py = 0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5

Qx = 0x58cd232129f77e18a4e0ae06c3f298d41ca35abb40a03997b1ba226104fb6722
Qy = 0x0d60be09cb87d89d3e486c3119589825160c59f037c52c106b4d23e7d0e8edab

Q = E(Qx, Qy)
P = E(Px, Py)

print (Q == 993913066650857197989941547339524640 * P)

# –ë—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω–æ:

# True
```
{% endcode %}

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:

{% code title="ecies.mjs" %}
```javascript
import http from 'http';
import {
  createECDH,
  createHash,
  createHmac,
  createCipheriv,
  createDecipheriv,
  randomBytes
} from 'crypto';

const hostname = '0.0.0.0';
const port     = 8080;

// KDF
function hashMessage(cipherName, message) {
  return createHash(cipherName).update(message).digest();
}

// MAC
function macMessage(cipherName, key, message) {
  return createHmac(cipherName, key).update(message).digest();
}

const serverECDH = createECDH('prime256v1');
const secretKey  = Buffer.from('bf6bb29560b6db07ac53849526aa20', 'hex');

// –ó–∞–¥–∞—ë–º –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á —Å–µ—Ä–≤–µ—Ä–∞
serverECDH.setPrivateKey(secretKey);

// –í–µ–∫—Ç–æ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è AES, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∑–∞–¥–∞—á–µ
const iv = Buffer.alloc(16, 0);

const encrypt = (message) => {
  // –°–æ–∑–¥–∞—ë–º –æ–±—ä–µ–∫—Ç ECDH (Elliptic Curve Diffie-Hellman) –¥–ª—è –æ–±–º–µ–Ω–∞ –∫–ª—é—á–∞–º–∏
  // –ö–ª—é—á–∏ - —ç—Ç–æ —Ç–æ—á–∫–∏ –Ω–∞ —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–æ–π –∫—Ä–∏–≤–æ–π, –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ prime256v1
  const ecdh = createECDH('prime256v1');
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–ª—é—á–∏. –í R –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω —ç—Ñ–µ–º–µ—Ä–Ω—ã–π –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ –Ω–µ—Å–∂–∞—Ç–æ–º –≤–∏–¥–µ
  // –ù–µ—Å–∂–∞—Ç–∞—è (uncompressed) —Ñ–æ—Ä–º–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å 0x04+x+y
  // x,y - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–ª—é—á–∞ –Ω–∞ —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–æ–π –∫—Ä–∏–≤–æ–π prime256v1
  // –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞ –≤ –æ–±—ä–µ–∫—Ç–µ ECDH
  const R = ecdh.generateKeys();
  // K - –æ–±—â–∏–π —Å–µ–∫—Ä–µ—Ç. –ù–∞–π–¥—ë–º –µ–≥–æ —É–º–Ω–æ–∂–µ–Ω–∏–µ–º —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á Q
  // computeSecret –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é DH_compute_key –∏–∑ OpenSSL
  // Q - –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å–µ—Ä–≤–µ—Ä–∞, –æ–Ω –µ—Å—Ç—å –≤ —É—Å–ª–æ–≤–∏—è—Ö –∑–∞–¥–∞—á–∏
  // Q == secretKey * P == serverECDH.getPublicKey()
  // –í K –±—É–¥–µ—Ç –ø–æ–º–µ—â–µ–Ω–∞ x-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ –æ–±—â–µ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞
  const K      = ecdh.computeSecret(serverECDH.getPublicKey());
  // –í—ã—á–∏—Å–ª—è–µ–º SHA-512 –æ—Ç –æ–±—â–µ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∫–ª—é—á–∏ Kenc –∏ Kmac
  const hash   = hashMessage('sha512', K);
  // Kenc - –ª–µ–≤–∞—è –ø–æ–ª–æ–≤–∏–Ω–∫–∞, Kmac - –ø—Ä–∞–≤–∞—è
  const encKey = hash.slice(0, hash.length / 2);
  const macKey = hash.slice(hash.length / 2);

  // –®–∏—Ñ—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ AES-CTR
  const cipher      = createCipheriv('aes-256-ctr', encKey, iv);
  const firstChunk  = cipher.update(message);
  const secondChunk = cipher.final();
  const cipherText  = Buffer.concat([firstChunk, secondChunk]);

  // –í—ã—á–∏—Å–ª—è–µ–º –∏–º–∏—Ç–æ–≤—Å—Ç–∞–≤–∫—É tag —á–µ—Ä–µ–∑ sha256
  const tag = macMessage(
    'sha256',
    macKey,
    cipherText
  );

  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–∫–ª–µ–π–∫—É R || tag || cipherText
  return Buffer.concat([R, tag, cipherText]);
};

const decrypt = (payload) => {
  // TODO
};

const error = (res, error) => {
  res.statusCode = 400;
  res.setHeader('Content-Type', 'application/json');
  res.end(JSON.stringify({error}));
};

const server = http.createServer(async (req, res) => {
  if (req.method === 'POST') {
    if (req.url === '/encrypt') {
      let data = '';

      for await (const chunk of req) {
        data += chunk;
      }

      if (!data) {
        error(res, 'Empty message');
      } else {
        try {
          res.statusCode = 200;
          res.setHeader('Content-Type', 'application/octet-stream');
          res.end(encrypt(data));
        } catch (e) {
          error(res, e.message);
        }
      }
    } else if (req.url === '/decrypt') {
      let data = Buffer.from([]);

      for await (const chunk of req) {
        data = Buffer.concat([data, chunk]);
      }

      if (!data) {
        error(res, 'Empty message');
      } else {
        const payload = Buffer.from(data);

        if (payload[0] !== 0x04) {
          error(res, 'Invalid R point format');
        } else {
          try {
            res.statusCode = 200;
            res.setHeader('Content-Type', 'text/plain');
            res.end(decrypt(payload));
          } catch (e) {
            error(res, e.message);
          }
        }
      }
    } else {
      error(res, 'Unknown URL');
    }
  } else {
    error(res, 'Unsupported HTTP method');
  }
});

server.listen(port, hostname, () => {
  console.log(`ECIES server running at http://${hostname}:${port}/`);
});

```
{% endcode %}

{% hint style="info" %}
–í –∑–∞–¥–∞—á–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –≤ –ø–æ–ª–µ **file**. –í –Ω–∞—à–µ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Ç–µ–ª–µ POST-–∑–∞–ø—Ä–æ—Å–∞, —á—Ç–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—â–µ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
{% endhint %}

–ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä:

```javascript
$ node ecies.mjs
```

–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É —á–µ—Ä–µ–∑ [Postman](../wastelands/getting-started.md#postman), –ø–µ—Ä–µ–¥–∞–≤ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫—É `flag`:

![&#x420;&#x435;&#x437;&#x443;&#x43B;&#x44C;&#x442;&#x430;&#x442; &#x432;&#x441;&#x435;&#x433;&#x434;&#x430; &#x431;&#x443;&#x434;&#x435;&#x442; &#x440;&#x430;&#x437;&#x43D;&#x44B;&#x43C; &#x438;&#x437;-&#x437;&#x430; &#x438;&#x441;&#x43F;&#x43E;&#x43B;&#x44C;&#x437;&#x43E;&#x432;&#x430;&#x43D;&#x438;&#x44F; &#x44D;&#x444;&#x435;&#x43C;&#x435;&#x440;&#x43D;&#x44B;&#x445; &#x43A;&#x43B;&#x44E;&#x447;&#x435;&#x439;](../.gitbook/assets/image%20%28217%29.png)

–°–æ—Ö—Ä–∞–Ω–∏–º –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –≤ —Ñ–∞–π–ª `encrypted.dat`, –Ω–∞–∂–∞–≤ –Ω–∞ **Save Response** ‚û°Ô∏è **Save to a file**. –ü–æ–ª—É—á–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫—Ä–∏–ø—Ç–æ—Å–∏—Å—Ç–µ–º—ã.

### –ö–æ–¥ –º–µ—Ç–æ–¥–∞ `/decrypt`

–ú–µ—Ç–æ–¥ `decrypt` –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–µ –∂–µ –¥–µ–π—Å—Ç–≤–∏—è, —á—Ç–æ –∏ `encrypt`, –Ω–æ –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ. –û–¥–Ω–∞–∫–æ, –º–µ—Ç–æ–¥ [`ecdh.computeSecret()`](https://nodejs.org/dist/latest-v15.x/docs/api/crypto.html#crypto_ecdh_computesecret_otherpublickey_inputencoding_outputencoding), –∫–æ—Ç–æ—Ä—ã–π –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –æ–±—â–µ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞, –Ω–∞–¥—ë–∂–µ–Ω - –æ–Ω –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –µ–º—É –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–æ–π –∫—Ä–∏–≤–æ–π. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞  `ERR_CRYPTO_ECDH_INVALID_PUBLIC_KEY`.

{% code title="/decrypt - –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ invalid curve attack \(secureDecrypt\)" %}
```javascript
// –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –¥–≤–µ —Å—Ç—Ä–æ–∫–∏ (–±—É—Ñ–µ—Ä–∞) –±–µ–∑ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –∫ –∞—Ç–∞–∫–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
function equalConstTime(b1, b2) {
  if (b1.length !== b2.length) {
    return false;
  }

  let result = 0;

  for (let i = 0; i < b1.length; i++) {
    result |= b1[i] ^ b2[i];
  }

  return result === 0;
}

const decrypt = (payload) => {
  const publicKeyLength = serverECDH.getPublicKey().length;
  
  const R = payload.slice(0, publicKeyLength);
  // computeSecret –ø—Ä–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ —Ç–æ—á–∫–∞ R –ª–µ–∂–∏—Ç –Ω–∞ —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–æ–π –∫—Ä–∏–≤–æ–π
  const K = serverECDH.computeSecret(R);

  // 32=256/8 - –¥–ª–∏–Ω–∞ MAC –≤ –±–∞–π—Ç–∞—Ö (SHA256)
  const tag        = payload.slice(publicKeyLength, publicKeyLength + 32);
  const cipherText = payload.slice(publicKeyLength + 32);

  const hash   = hashMessage('sha512', K);
  const encKey = hash.slice(0, hash.length / 2);
  const macKey = hash.slice(hash.length / 2);

  const computedTag = macMessage(
    'sha256',
    macKey,
    cipherText
  );

  // –¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—ã—á–∏—Å–ª–µ–Ω–Ω–∞—è –∏–º–∏—Ç–æ–≤—Å—Ç–∞–≤–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–Ω—è—Ç–æ–π
  if (!equalConstTime(tag, computedTag)) {
    throw new Error('Incorrect tag');
  }

  const cipher      = createDecipheriv('aes-256-ctr', encKey, iv);
  const firstChunk  = cipher.update(cipherText);
  const secondChunk = cipher.final();

  return Buffer.concat([firstChunk, secondChunk]).toString();
};
```
{% endcode %}

–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ [Postman](../wastelands/getting-started.md#postman):

![&#x41F;&#x43E;&#x43B;&#x443;&#x447;&#x438;&#x43B;&#x438; &#x438;&#x441;&#x445;&#x43E;&#x434;&#x43D;&#x443;&#x44E; &#x441;&#x442;&#x440;&#x43E;&#x43A;&#x443; flag](../.gitbook/assets/image%20%28218%29.png)

–ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ–π –∞—Ç–∞–∫—É **Invalid curve attack**, –º—ã –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ —Ä–µ–∞–ª–∏–∑—É–µ–º –º–µ—Ç–æ–¥ `decrypt` —Å —É—è–∑–≤–∏–º–æ—Å—Ç—å—é: –Ω–µ –±—É–¥–µ–º –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º–æ–≥–æ –∫–ª—é—á–∞ —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–æ–π –∫—Ä–∏–≤–æ–π **`secp256r1`**.

{% hint style="info" %}
–î–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑—É–µ–º —Å–ª–æ–∂–µ–Ω–∏–µ –∏ —É–º–Ω–æ–∂–µ–Ω–∏–µ —Ç–æ—á–µ–∫ –Ω–∞ —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–æ–π –∫—Ä–∏–≤–æ–π.
{% endhint %}

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `decrypt` —Å —É—è–∑–≤–∏–º–æ—Å—Ç—å—é:

{% code title="/decrypt - c –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é invalid curve attack" %}
```javascript
const p = 0xffffffff00000001000000000000000000000000ffffffffffffffffffffffffn;
const a = p - 3n;

function mod(a, b = p) {
  const result = a % b;

  return result >= 0 ? result : b + result;
}

// https://brilliant.org/wiki/extended-euclidean-algorithm/
function egcd(a, b) {
  let [x, y, u, v] = [0n, 1n, 1n, 0n];

  while (a !== 0n) {
    let [q, r] = [b / a, b % a];
    let [m, n] = [x - u * q, y - v * q];

    [b, a] = [a, r];
    [x, y] = [u, v];
    [u, v] = [m, n];
  }

  return [b, x, y];
}

function invert(number, modulo = p) {
  if (number === 0n || modulo <= 0n) {
    throw new Error('invert: expected positive integers');
  }

  let [gcd, x] = egcd(mod(number, modulo), modulo);

  if (gcd !== 1n) {
    throw new Error('invert: does not exist');
  }

  return mod(x, modulo);
}

// –¢–æ—á–∫–∞ –Ω–∞ —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–æ–π –∫—Ä–∏–≤–æ–π
class Point {
  static #ZERO = new Point(0n, 0n);

  constructor(x, y) {
    this.x = x;
    this.y = y;
  }

  add(other) {
    const [a, b]           = [this, other];
    const [X1, Y1, X2, Y2] = [a.x, a.y, b.x, b.y];

    if (X1 === 0n || Y1 === 0n)
      return b;

    if (X2 === 0n || Y2 === 0n)
      return a;

    if (X1 === X2 && Y1 === Y2)
      return this.double();

    if (X1 === X2 && Y1 === -Y2)
      return Point.#ZERO;

    const lam = mod((Y2 - Y1) * invert(X2 - X1, p));
    const X3  = mod(lam * lam - X1 - X2);
    const Y3  = mod(lam * (X1 - X3) - Y1);

    return new Point(X3, Y3);
  }

  double() {
    const X1  = this.x;
    const Y1  = this.y;
    const lam = mod((3n * X1 * X1 + a) * invert(2n * Y1, p));
    const X3  = mod(lam * lam - 2n * X1);
    const Y3  = mod(lam * (X1 - X3) - Y1);

    return new Point(X3, Y3);
  }

  multiply(n) {
    let dbl = new Point(this.x, this.y);
    let p   = Point.#ZERO;
    let f   = Point.#ZERO;

    for (let i = 0; i <= 256; i++) {
      if ((n & 1n) === 1n)
        p = p.add(dbl);
      else f = f.add(dbl);

      n >>= 1n;
      dbl = dbl.double();
    }

    return p;
  }
}

const decrypt = (payload) => {
  const publicKeyLength = serverECDH.getPublicKey().length;

  const R  = payload.slice(0, publicKeyLength);
  const Rx = R.slice(1, 33);
  const Ry = R.slice(33);

  const RPoint = new Point(BigInt('0x' + Rx.toString('hex')),
    BigInt('0x' + Ry.toString('hex')));

  const K = RPoint.multiply(BigInt('0x' + secretKey.toString('hex')));

  // 32=256/8 - –¥–ª–∏–Ω–∞ MAC –≤ –±–∞–π—Ç–∞—Ö (SHA256)
  const tag        = payload.slice(publicKeyLength, publicKeyLength + 32);
  const cipherText = payload.slice(publicKeyLength + 32);

  const hash   = hashMessage('sha512', Buffer.from(K.x.toString(16), 'hex'));
  const encKey = hash.slice(0, hash.length / 2);
  const macKey = hash.slice(hash.length / 2);

  const computedTag = macMessage(
    'sha256',
    macKey,
    cipherText
  );

  // –¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—ã—á–∏—Å–ª–µ–Ω–Ω–∞—è –∏–º–∏—Ç–æ–≤—Å—Ç–∞–≤–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–Ω—è—Ç–æ–π
  if (!equalConstTime(tag, computedTag)) {
    throw new Error('Incorrect tag');
  }

  const cipher      = createDecipheriv('aes-256-ctr', encKey, iv);
  const firstChunk  = cipher.update(cipherText);
  const secondChunk = cipher.final();

  return Buffer.concat([firstChunk, secondChunk]).toString();
};
```
{% endcode %}

–¢–µ–ø–µ—Ä—å –º–µ—Ç–æ–¥ –≤—ã—á–∏—Å–ª—è–µ—Ç –æ–±—â–∏–π —Å–µ–∫—Ä–µ—Ç `K` –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ —Ç–æ—á–∫–∏ `R` —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–æ–π –∫—Ä–∏–≤–æ–π. –ê —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –º–æ–∂–Ω–æ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–∑–Ω–∞—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á —Å–µ—Ä–≤–µ—Ä–∞, –ø–µ—Ä–µ–¥–∞–≤–∞—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ —Ç–æ—á–∫–∏. 

### –ê—Ç–∞–∫—É–µ–º —Å–µ—Ä–≤–µ—Ä

–í –ª–∏—Å—Ç–∏–Ω–≥–µ –≤—ã—à–µ —É–º–Ω–æ–∂–µ–Ω–∏–µ —Ç–æ—á–∫–∏ `R` –Ω–∞ —Å–∫–∞–ª—è—Ä \(—Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á\) –≤ 110-–π —Å—Ç—Ä–æ–∫–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `b` –≤ —Ä–∞—Å—á—ë—Ç–∞—Ö. –ö–æ–¥ —É–º–Ω–æ–∂–µ–Ω–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è, –Ω–∞—á–∏–Ω–∞—è —Å 82-–π —Å—Ç—Ä–æ–∫–∏.

{% code title="https://sagecell.sagemath.org/" %}
```python
b = 0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b
```
{% endcode %}

–ò –∫–∞–∫ –±—ã–ª–æ —Ä–∞–Ω–µ–µ —Å–∫–∞–∑–∞–Ω–æ, —Ç–µ–ø–µ—Ä—å —Å–µ—Ä–≤–µ—Ä –≤–æ–≤—Å–µ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ç–æ—á–∫–∞ `R` –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∫—Ä–∏–≤–æ–π **`secp256r1`**.

#### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –º—ã –º–æ–∂–µ–º –ø–µ—Ä–µ—Å–ª–∞—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Ç–æ—á–∫—É `R'`, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å –¥—Ä—É–≥–æ–π –∫—Ä–∏–≤–æ–π `E'` —Å –æ—Ç–ª–∏—á–∞—é—â–∏–º—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `b`. –ü—Ä–∏ —ç—Ç–æ–º –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å `b` –Ω–µ –æ—á–µ–Ω—å –±–æ–ª—å—à–∏–º, —á—Ç–æ–±—ã –ø–æ—Ä—è–¥–æ–∫ –∫—Ä–∏–≤–æ–π `n'` —Å—Ç–∞–ª —Å–æ—Å—Ç–∞–≤–Ω—ã–º —á–∏—Å–ª–æ–º —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –º–∞–ª—ã–º–∏ –ø—Ä–æ—Å—Ç—ã–º–∏ –º–Ω–æ–∂–∏—Ç–µ–ª—è–º–∏. –î–∞–ª–µ–µ, –≤–∑—è–≤ –Ω–µ–±–æ–ª—å—à–æ–π –ø—Ä–æ—Å—Ç–æ–π –º–Ω–æ–∂–∏—Ç–µ–ª—å `l` –∏–∑ —Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ `n'`, –º–æ–∂–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ç–æ—á–∫—É-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä `G` –º–∞–ª–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ \(`l`\).  –í—Å–ø–æ–º–Ω–∏–º, —á—Ç–æ –æ–±—â–∏–π —Å–µ–∫—Ä–µ—Ç –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–æ —Å–ª–µ–¥—É—é—â–µ–π —Ñ–æ—Ä–º—É–ª–µ:

$$
K = secretKey\times R
$$

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –ø–µ—Ä–µ–º–Ω–æ–∂–∞—Ç—å —Å–≤–æ–π –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –Ω–∞ –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é —Ç–æ—á–∫—É `R` –∏ –¥–∞–ª–µ–µ –≤—ã—á–∏—Å–ª—è—Ç—å –∏–º–∏—Ç–æ–≤—Å—Ç–∞–≤–∫—É. –ï—Å–ª–∏ —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–¥–∞—Ç—å —Ç–æ—á–∫—É `R'` —Å –º–∞–ª—ã–º –ø–æ—Ä—è–¥–∫–æ–º `l`, —Ç–æ –Ω–æ–≤—ã–π –æ–±—â–∏–π —Å–µ–∫—Ä–µ—Ç `K'` –±—É–¥–µ—Ç –∏–º–µ—Ç—å `l` —Ä–∞–∑–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π, —Ç–∞–∫ –∫–∞–∫ –º—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è –≤ —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–π –ø–æ–¥–≥—Ä—É–ø–ø–µ. –ú—ã –º–æ–∂–µ–º —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∑–Ω–∞—á–µ–Ω–∏—è —Ç–æ—á–∫–∏ `R'` –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –µ—ë –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –æ–Ω –Ω–µ –ø—Ä–∏–º–µ—Ç –Ω–∞—à –∑–∞–ø—Ä–æ—Å. –≠—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —Ç–æ–º —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ –≤—ã—á–∏—Å–ª–µ–Ω–Ω–∞—è –∏–º–∏—Ç–æ–≤—Å—Ç–∞–≤–∫–∞ —Å–æ–≤–ø–∞–¥—ë—Ç —Å —Ç–æ–π, –∫–æ—Ç–æ—Ä–∞—è –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –∑–∞–ø—Ä–æ—Å–µ.

–ò—Ç–∞–∫, –Ω–∞–º –Ω—É–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—Ä–∏–≤—ã—Ö `E'` —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ `b`, –¥–∞–ª–µ–µ –≤ –∫–∞–∂–¥–æ–π –∫—Ä–∏–≤–æ–π –Ω–∞–π—Ç–∏ –ø–æ—Ä—è–¥–æ–∫ `l`, —Ä–∞–∑–ª–æ–∂–∏—Ç—å –Ω–∞ –ø—Ä–æ—Å—Ç—ã–µ –º–Ω–æ–∂–∏—Ç–µ–ª–∏, –≤—ã–±—Ä–∞—Ç—å –ª—é–±–æ–π –Ω–µ–±–æ–ª—å—à–æ–π –º–Ω–æ–∂–∏—Ç–µ–ª—å, –ø–æ –Ω–µ–º—É –≤—ã—á–∏—Å–ª–∏—Ç—å –±–∞–∑–æ–≤—É—é \(–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä\) —Ç–æ—á–∫—É `G`, –∏ –ø—É—Ç–µ–º –ø–µ—Ä–µ–º–Ω–æ–∂–µ–Ω–∏—è –≤—Å–µ—Ö —á–∏—Å–µ–ª –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ \[`1`, `l-1`\] –Ω–∞ `G` –æ—Ç—ã—Å–∫–∞—Ç—å —Ç–∞–∫—É—é —Ç–æ—á–∫—É `R'`, –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –∫–æ—Ç–æ—Ä–æ–π —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏–º–µ—Ç –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –æ—à–∏–±–æ–∫ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫—É:

$$
R' = w\in[1, l-1]\times G
$$

–û—à–∏–±–∫–∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ —Å –≤—ã—Å–æ–∫–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é –Ω–µ –±—É–¥–µ—Ç –≤ —Ç–æ–º —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Å–∫–∞–ª—è—Ä–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å `w` –ø–µ—Ä–µ–¥ `G` –±—É–¥—É—Ç [—Å—Ä–∞–≤–Ω–∏–º—ã ](https://ru.wikipedia.org/wiki/%D0%A1%D1%80%D0%B0%D0%B2%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE_%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8E)–ø–æ –º–æ–¥—É–ª—é `l`:

$$
w\equiv \pm secretKey\mod{l}
$$

–ó–Ω–∞–∫ ¬± –∑–¥–µ—Å—å –æ–∑–Ω–∞—á–∞–µ—Ç —Ç–æ—Ç —Ñ–∞–∫—Ç, —á—Ç–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç 2 –∑–Ω–∞—á–µ–Ω–∏—è `w`, –ø—Ä–∏ –∫–æ—Ç–æ—Ä—ã—Ö –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞. –≠—Ç–æ –æ–±—É—Å–ª–æ–≤–ª–µ–Ω–æ —Ç–µ–º, —á—Ç–æ —É —Ç–æ—á–µ–∫ —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–æ–π –∫—Ä–∏–≤–æ–π `P` –∏ -`P` –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è `x`-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞, –∞ –≤–µ–¥—å –∏–º–µ–Ω–Ω–æ –æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∫–ª—é—á–µ–π –∏–∑ –æ–±—â–µ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞. –¢–∞–∫, –µ—Å–ª–∏ `l = 17`, `w = 2` –∏ –≤ —Ç–∞–∫–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫, —Ç–æ –∏—Ö —Ç–∞–∫–∂–µ –Ω–µ –±—É–¥–µ—Ç, –µ—Å–ª–∏ `w` –∑–∞–¥–∞—Ç—å —Ä–∞–≤–Ω—ã–º `17-2=15` –∏–ª–∏ `-2`.

–ß—Ç–æ–±—ã –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç ¬±, –±—É–¥–µ—Ç –æ–ø–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏, –≤–æ–∑–≤–µ–¥—ë–Ω–Ω—ã–º–∏ –≤ –∫–≤–∞–¥—Ä–∞—Ç—ã:

$$
w^2\equiv  secretKey^2\mod{l}
$$

–ù–∞–π–¥—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–∫–∏—Ö —Ç–æ—á–µ–∫ `R'`, —É –Ω–∞—Å –≤ –Ω–∞–ª–∏—á–∏–∏ –±—É–¥—É—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ä—ã –∑–Ω–∞—á–µ–Ω–∏–π `w` –∏ `l`, –∫–æ—Ç–æ—Ä—ã–µ, –≤–æ–∑–≤–µ–¥–µ–Ω—ã –≤ –∫–≤–∞–¥—Ä–∞—Ç. –ü—Ä–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Ç–∞–∫–∏—Ö –ø–∞—Ä –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á, –∏—Å–ø–æ–ª—å–∑—É—è –∫–∏—Ç–∞–π—Å–∫—É—é —Ç–µ–æ—Ä–µ–º—É –æ–± –æ—Å—Ç–∞—Ç–∫–∞—Ö:

$$
w^2=CRT([w_1,w_2,...,w_n],[l_1,l_2,...,l_n])
$$

–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ `n` –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∏—Å—Ö–æ–¥—è –∏–∑ –ø—Ä–∏–º–µ—Ä–Ω–æ–π –≤–µ–ª–∏—á–∏–Ω—ã —Å–µ–∫—Ä–µ—Ç–∞. –ú—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ–º –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤—ã—á–∏—Å–ª–µ–Ω –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–π –∫–æ—Ä–µ–Ω—å:

$$
secretKey=\sqrt{w^2}
$$

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

{% embed url="http://the2702.com/2015/05/08/invalid-curve-attack.html" %}

{% embed url="https://paulmillr.com/posts/noble-secp256k1-fast-ecc/" %}

{% embed url="https://cryptobook.nakov.com/" caption="–ö–Ω–∏–≥–∞ Practical Cryptography for Developers" %}

{% file src="../.gitbook/assets/breaking-the-bluetooth-pairing-fixed-coordinate-invalid-curve-attack.pdf" %}

{% file src="../.gitbook/assets/practical-invalid-curve-attacks-on-tls-ecdh.pdf" %}

{% file src="../.gitbook/assets/validation-of-elliptic-curve-public-keys.pdf" %}

