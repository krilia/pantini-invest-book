# Создание репозитория рабочего проекта

{% hint style="warning" %}
_Репозиторием_ называют место, где хранится код проекта.

Вся текущая и будущая разработка будет производиться в [одном](https://ru.wikipedia.org/wiki/%D0%9C%D0%BE%D0%BD%D0%BE%D1%80%D0%B5%D0%BF%D0%BE%D0%B7%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%B9) репозитории [Github](https://github.com/) под названием [**jpx** ](https://github.com/johnpantini/jpx/tree/johnpantini)\(**J**ohn **P**antini E**x**tensions\).

**Github** нужен для удобного распространения исходного кода всего проекта между заинтересованными участниками. Внутри **Github** используется система контроля версий [**Git**](https://ru.wikipedia.org/wiki/Git) ****\(о ней речь пойдёт позднее\).
{% endhint %}

## Установка Git

Система контроля версий \(СКВ\) **Git** - это набор программ, которые позволят нам сохранять написанный код у себя локально и в том числе отправлять все правки на сервер **Github** в наш репозиторий \(создадим позднее\).

Несмотря на то, что в [главе ](getting-started.md#ustanovka-terminala-cmder)о подготовке рабочей среды мы установили терминал **Cmder** со встроенным **Git**, для более простого доступа к СКВ установим его глобально в **Program Files**. Для этого нужно зайти на сайт и скачать установочный дистрибутив:

{% embed url="https://git-scm.com/download/win" %}

Загрузка начнётся автоматически. Если нет, нажимаем **Click here to download manually**:

![&#x417;&#x430;&#x433;&#x440;&#x443;&#x437;&#x43A;&#x430; Git](../.gitbook/assets/image%20%2862%29.png)

Запускаем установщик, принимаем лицензионное соглашение, папку установки не меняем, флаги компонентов тоже можно не трогать.

На странице выбора редактора для Git можно ничего не менять \(вряд ли он будет использоваться\), а можно выбрать другой редактор, если таковой установлен в системе. Я выберу [Notepad++](https://notepad-plus-plus.org/downloads/):

![&#x41C;&#x43E;&#x436;&#x43D;&#x43E; &#x432;&#x44B;&#x431;&#x440;&#x430;&#x442;&#x44C; &#x43B;&#x44E;&#x431;&#x43E;&#x439; &#x434;&#x43E;&#x441;&#x442;&#x443;&#x43F;&#x43D;&#x44B;&#x439; &#x440;&#x435;&#x434;&#x430;&#x43A;&#x442;&#x43E;&#x440; &#x434;&#x43B;&#x44F; Git](../.gitbook/assets/image%20%2865%29.png)

На странице выбора имени ветви репозитория по умолчанию выбираем второй вариант:

 

![&#x412;&#x44B;&#x431;&#x438;&#x440;&#x430;&#x435;&#x43C; main](../.gitbook/assets/image%20%2871%29.png)

{% hint style="info" %}
**Ветвь** \("ветка"\) репозитория -  это механизм для параллельной разработки в рамках одного репозитория. Например, каждый разработчик может работать над одной определённой функцией в своей личной ветке.

В дальнейшем разработчики смогут скомбинировать изменения из разных ветвей в одну, которая, вероятно, пойдёт в production \(боевой режим\).

Раньше при создании репозитория автоматически создавалась ветвь по умолчанию под названием **master**. Но сейчас эта практика [изменилась](https://github.blog/changelog/2020-10-01-the-default-branch-for-newly-created-repositories-is-now-main/), теперь все репозитории Github начинают своё существование с ветки **main**.
{% endhint %}

Далее будет предложено выбрать, как модифицировать системные переменные окружения. Ничего не меняем, оставляем рекомендованный вариант:

![](../.gitbook/assets/image%20%2867%29.png)

Далее будет предложено выбрать клиент SSH. Оставляем по умолчанию.

![](../.gitbook/assets/image%20%2872%29.png)

Далее выбираем, какую библиотеку будет использовать Git для создания защищённых соединений. Оставляем по умолчанию.

![](../.gitbook/assets/image%20%2869%29.png)

Далее предстоит сделать выбор глобальной настройки, которой будет придерживаться Git при сохранении текстовых файлов, а именно [**окончаний строк**](https://ru.wikipedia.org/wiki/%D0%9F%D0%B5%D1%80%D0%B5%D0%B2%D0%BE%D0%B4_%D1%81%D1%82%D1%80%D0%BE%D0%BA%D0%B8).

{% hint style="info" %}
Окончание строки в текстовом файле обозначается специальным непечатным символом **`LF`** \(line feed\), или даже парой символов **`CRLF`**\(carriage return + line feed\) в зависимости от операционной системы.

 Unix, Linux и Mac OS X используют **`LF`**, а Windows **`CRLF`**
{% endhint %}

Мы будем вести разработку преимущественно в Linux-среде \(позднее\), в нашем случае остановимся на варианте, когда **Git** будет автоматически конвертировать CRLF в LF при сохранении изменений, а в обратном случае \(переключение между файлами и ветвями, когда файлы меняются на диске - **checkout**\) не будет делать ничего:

![](../.gitbook/assets/image%20%2863%29.png)

{% hint style="danger" %}
Эта настройка по работе с окончаниями строка называется **core.autocrlf**; на Windows при использовании установщика она сохраняется в не совсем корректное место. Позже мы установим эту настройку еще раз, но уже из терминала с командной строкой.
{% endhint %}

Далее нам предложат выбрать эмулятор терминала для Git Bash. Оставляем без изменений:

![](../.gitbook/assets/image%20%2870%29.png)

Далее нужно выбрать алгоритм применения изменений при использовании команды **git pull**, оставляем вариант по умолчанию:

![](../.gitbook/assets/image%20%2866%29.png)

Далее выбираем менеджер учётных данных для Git, оставляем по умолчанию:

![](../.gitbook/assets/image%20%2861%29.png)

На следующей странице выбираем флаги для дополнительных функций \(всё по умолчанию\):

![](../.gitbook/assets/image%20%2864%29.png)

![](../.gitbook/assets/image%20%2868%29.png)

Нажимаем **Install**, ждём завершения установки. Далее запускаем **Windows PowerShell**, и выполняем ряд команд \(после решётки **\#** идут комментарии, вводить их не нужно\):

```bash
$ git --version # Проверка версии git
```

Теперь настроим окончание строк по умолчанию, которое будет использовать Git при записи файлов в рабочую папку репозитория:

```bash
$ git config --global core.eol lf # Запись LF в настройку core.eol (end of line)
```

Чтобы проверить, что настройка записалась, вызовем команду:

```bash
$ git config --global core.eol # Проверка - должна вывести lf
```

Наконец, корректно зададим настройку **core.autocrlf**, о которой говорилось выше:

```bash
$ git config --global core.autocrlf input # Автоматически заменять CRLF на LF
$ git config --global core.autocrlf # Проверка - должна вывести input
```

{% hint style="info" %}
Все глобальные настройки **Git** можно переопределять, для этого в репозитории нужно создать файл`.gitattributes`, в котором задать необходимые [опции](https://git-scm.com/book/ru/v2/%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-Git-%D0%90%D1%82%D1%80%D0%B8%D0%B1%D1%83%D1%82%D1%8B-Git) на уровне проекта. Шаблоны для различных языков и платформ можно просмотреть [по ссылке](https://github.com/alexkaratarakis/gitattributes).
{% endhint %}

## Вариант 1. Самостоятельное ведение репозитория

В этом случае вы создадите свой личный репозиторий, в котором будете самостоятельно сохранять все изменения в коде. Т.е. фактически будете делать те же самые операции, что и я. При этом у вас будет возможность вносить собственные независимые правки по личным предпочтениям и нуждам, развивать проект на своё усмотрение.

{% hint style="info" %}
Это вариант, с которого стартую я. Репозиторий в дальнейшем для краткости буду называть **репо**.
{% endhint %}

После регистрации \(если нет аккаунта\) на сайте [github.com](https://github.com) переходим в профиль, выбираем вкладку **Repositories**, далее нажимаем **New**, либо сразу переходим по [ссылке ](https://github.com/new)создания нового репо:

![&#x421;&#x43E;&#x437;&#x434;&#x430;&#x43D;&#x438;&#x435; &#x43D;&#x43E;&#x432;&#x43E;&#x433;&#x43E; &#x440;&#x435;&#x43F;&#x43E; \(&#x43E;&#x431;&#x44F;&#x437;&#x430;&#x442;&#x435;&#x43B;&#x44C;&#x43D;&#x43E; &#x442;&#x43E;&#x43B;&#x44C;&#x43A;&#x43E; &#x43D;&#x430;&#x437;&#x432;&#x430;&#x43D;&#x438;&#x435;\)](../.gitbook/assets/image%20%2848%29.png)

{% hint style="info" %}
Флажок **Add .gitignore** позволяет включить в проект специальный файл, в котором перечисляются файлы и директории, которые будут скрыты от системы контроля версий. Они не будут сохраняться на серверах **Github** в репо. Выбираем шаблон **Node**, т.к. большую часть времени будем разрабатывать на **JavaScript** через платформу **Node.js**
{% endhint %}

{% hint style="info" %}
Флажок лицензии позволяет установить таковую для проекта. Выбираем демократичную [MIT](https://ru.wikipedia.org/wiki/%D0%9B%D0%B8%D1%86%D0%B5%D0%BD%D0%B7%D0%B8%D1%8F_MIT).
{% endhint %}

Нажимаем **Create repository** и ждём ответа от сервера.

![&#x412;&#x438;&#x434; &#x440;&#x435;&#x43F;&#x43E; &#x441;&#x440;&#x430;&#x437;&#x443; &#x43F;&#x43E;&#x441;&#x43B;&#x435; &#x441;&#x43E;&#x437;&#x434;&#x430;&#x43D;&#x438;&#x44F;](../.gitbook/assets/image%20%2845%29.png)

Теперь репозиторий готов к работе.

## Вариант 2. Работа с копией моего репозитория \(fork\)

В таком случае вы получите копию моего оригинального репозитория в свой аккаунт Github, сможете делать свои собственные правки, а также получать все внесённые мною изменения, когда пожелаете. Изменения, сделанные в скопированном через **fork** репозитории, можно предлагать к слиянию с оригинальным репо через механизм, который называется **pull requests** \(запросы на принятие изменений\).

Чтобы скопировать репозиторий себе, нужно нажать кнопку **Fork** в панели кнопок в правой части вверху страницы \(для своих репо кнопка будет неактивна\):

![&#x414;&#x43B;&#x44F; &#x43A;&#x43E;&#x43F;&#x438;&#x440;&#x43E;&#x432;&#x430;&#x43D;&#x438;&#x44F; &#x440;&#x435;&#x43F;&#x43E; &#x43D;&#x430;&#x436;&#x438;&#x43C;&#x430;&#x435;&#x43C; Fork](../.gitbook/assets/image%20%2879%29.png)

Копирование произойдет автоматически. Далее можно работать аналогично первому варианту.

## Вариант 3. Работа с локальным клоном моего репозитория

В этом случае ваш аккаунт Github не претерпит никаких изменений, а копия репозитория будет храниться только на вашем диске в режиме для чтения. В любой момент вы сможете синхронизировать \(принять\) мои правки, поддерживая исходный код в актуальном состоянии.

#### TL;DR

{% hint style="warning" %}
Какой вариант выбрать для работы? Самый простой вариант - третий. **Рекомендуется для новичков**. Автор книги идёт по первому варианту \(как создатель проекта\).
{% endhint %}

## Подключение репозитория проекта в WebStorm

В главе про [подготовку рабочей среды](getting-started.md#setting-up-ide) мы установили IDE **WebStorm** и сделали первичную настройку. Если **WebStorm** был запущен до установки **Git**, выполните перезапуск программы.

Нажимаем **Get from VCS** с главного экрана:

![](../.gitbook/assets/image%20%2893%29.png)

### Для тех, кто выбрал 2 вариант работы с репо \(через Fork\)

Переключаемся на вкладку **GitHub**, нажимаем **Log In via GitHub...**, авторизуемся в открывшейся странице, на последнем этапе нажимаем **Authorize JetBrains**:

![&#x410;&#x432;&#x442;&#x43E;&#x440;&#x438;&#x437;&#x430;&#x446;&#x438;&#x44F; &#x447;&#x435;&#x440;&#x435;&#x437; GitHub](../.gitbook/assets/image%20%2894%29.png)

Теперь вернитесь в **WebStorm**. Если все прошло успешно, репо **jpx** будет в списке, выберите его и нажмите **Clone**. Папку для проекта выберите любую на свое усмотрение или оставьте по умолчанию.

### Для тех, кто выбрал первый или третий вариант работы с репо

Нам нужно узнать полный URL репозитория, что можно сделать через **Github**. Перейдите по ссылке [https://github.com/johnpantini/jpx](https://github.com/johnpantini/jpx) и нажмите кнопку **Code**, далее скопируйте ссылку:

{% hint style="info" %}
У тех, кто работает по 1-му варианту, ссылка на репо будет отличаться \(другое имя профиля\).
{% endhint %}

![&#x41D;&#x430;&#x436;&#x43C;&#x438;&#x442;&#x435; &#x43A;&#x43D;&#x43E;&#x43F;&#x43A;&#x443; Code &#x438; &#x441;&#x43A;&#x43E;&#x43F;&#x438;&#x440;&#x443;&#x439;&#x442;&#x435; &#x441;&#x441;&#x44B;&#x43B;&#x43A;&#x443;](../.gitbook/assets/image%20%2891%29.png)

Возвращаемся в **WebStorm** и вставляем ссылку \(папку для проекта я оставил по умолчанию, но можно выбрать любую\), нажимаем **Clone**:

![](../.gitbook/assets/image%20%2889%29.png)

Далее проект будет создан и загружен в **WebStorm**:

![](../.gitbook/assets/image%20%2877%29.png)

В правом нижнем углу программы есть надпись **main**, которая обозначает **текущую** ветку репо.

{% hint style="warning" %}
Для работы с кодом я тут же создам свою "личную" ветку с именем **johnpantini**.
{% endhint %}

Для создания новой ветки я нажимаю на **main**, во всплывающем меню выбираю **New Branch**, далее ввожу название ветки, нажимаю **Create**:

![&#x421;&#x43E;&#x437;&#x434;&#x430;&#x43D;&#x438;&#x435; &#x43B;&#x43E;&#x43A;&#x430;&#x43B;&#x44C;&#x43D;&#x43E;&#x439; &#x432;&#x435;&#x442;&#x43A;&#x438; &#x440;&#x435;&#x43F;&#x43E;](../.gitbook/assets/image%20%2885%29.png)

Если будет предложено добавить файлы конфигурации проекта в репо, я откажусь \(**Don't Ask Again**\).

{% hint style="info" %}
Я добавил панель инструментов в **WebStorm**, выбрав в меню **View ➡️** **Appearance** флаг **Toolbar**.
{% endhint %}

## Сохранение изменений в репо \(первый и второй варианты\)

Я добавлю два служебных файла в проект. Один из них, `.gitattributes`, уже обсуждался ранее. Он содержит информацию о том, как **Git** должен обрабатывать те или иные файлы \(как текстовые или бинарные\) в зависимости от расширений/имён. Мы возьмем готовый шаблон по [ссылке](https://github.com/alexkaratarakis/gitattributes/blob/master/Common.gitattributes).

{% hint style="info" %}
Чтобы загрузить файл из репозитория **GitHub**, нажмите кнопку **Raw** в панели с содержимым. Далее нажмите Ctrl + S, чтобы сохранить файл на диск \(в любое место\). После этого откройте файл в Проводнике и скопируйте \(Ctrl + C на выделенном файле\).
{% endhint %}

Поместите скопированный файл в директорию проекта через **WebStorm** \(нажмите Ctrl + V, предварительно выделив папку проекта в файловом дереве\); будет предложено добавить новый файл на контроль **Git**. Соглашаемся, выставив флаг **Don't ask again**:

![](../.gitbook/assets/image%20%2883%29.png)

{% hint style="info" %}
Файлы, которые не версионируются **Git**, помечаются коричневым цветом. Файлы, которые добавлены на контроль **Git**, но не сохранялись в репо, обозначаются зелёным. Наконец, файлы, которые сохранялись в репо, но были изменены, помечаются синим цветом.
{% endhint %}

Второй файл, который будет добавлен в проект, называется `.editorconfig`. Он определяет настройки отображения и обработки текстовых файлов, подробности можно получить на [официальном сайте](https://editorconfig.org/). Содержимое будет таким:

```bash
# editorconfig.org

# Файл верхнего уровня
root = true

[*]
# Ипользуем пробелы вместо табуляции для отступов
indent_style = space
# 2 пробела - отступы в коде
indent_size = 2
# Окончание строк LF (как в Linux)
end_of_line = lf
# Кодировка UTF-8
charset = utf-8
# Удалять все пробельные символы перед окончаниями строк
trim_trailing_whitespace = true
# Автоматически вставлять одну пустую строку в конец текстовых файлов
insert_final_newline = true

[*.md]
# Для файлов типа Markdown отключить опцию
trim_trailing_whitespace = false
```

В итоге в нашем проекте появятся два новых файла, которые теперь стоит сохранить в репо:

![](../.gitbook/assets/image%20%2892%29.png)

Сохранение изменений в репо называется [**commit**](https://git-scm.com/book/ru/v2/%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D1%8B-Git-%D0%97%D0%B0%D0%BF%D0%B8%D1%81%D1%8C-%D0%B8%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B9-%D0%B2-%D1%80%D0%B5%D0%BF%D0%BE%D0%B7%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%B9). Для этого нажимаем сочетание клавиш **Ctrl + K** либо выбираем пункт меню **Commit...** из меню **Git** или панели инструментов \(зелёная галочка\):

![](../.gitbook/assets/image%20%2874%29.png)

**Default Changelist** - это список файлов, которые отслеживаются **Git** и могут быть сохранены, потому что изменились \(либо только создались\).

**Unversioned Files** - файлы, которые не отслеживаются **Git**. В нашем случае там находятся служебные файлы **WebStorm** из скрытой директории **.idea**. Чтобы вообще не видеть этот список, добавим **.idea** в список путей, игнорируемых **Git** в файл `.gitignore`:

![&#x41F;&#x43E;&#x441;&#x43B;&#x435; &#x432;&#x43D;&#x435;&#x441;&#x435;&#x43D;&#x438;&#x44F; &#x438;&#x437;&#x43C;&#x435;&#x43D;&#x435;&#x43D;&#x438;&#x439; &#x444;&#x430;&#x439;&#x43B; &#x43F;&#x43E;&#x434;&#x441;&#x432;&#x435;&#x447;&#x438;&#x432;&#x430;&#x435;&#x442;&#x441;&#x44F; &#x441;&#x438;&#x43D;&#x438;&#x43C; &#x446;&#x432;&#x435;&#x442;&#x43E;&#x43C;](../.gitbook/assets/image%20%2881%29.png)

Вернитесь на вкладку **Commit** из вертикальной панели вкладок и выберите все файлы:

![](../.gitbook/assets/image%20%2878%29.png)

Нажмите на шестерёнку возле надписи **Amend** и снимите все флаги в секции **Before Commit**:

![](../.gitbook/assets/image%20%2873%29.png)

 Теперь введите краткое пояснение о сделанных правках \(на картинке уже введено\): 

> Add gitattributes & editorconfig

Нажмите **Commit**, изменения сохранятся в репо. Если у вас запросят ввести имя и E-mail, сделайте это:

![](../.gitbook/assets/image%20%2896%29.png)

Таким образом можно периодически сохранять любые изменения с пояснениями. Но чтобы отправить правки на сервер **Github**, вам понадобится сделать дополнительное действие - так называемый **push** \(Ctrl+Shift+K или аналогичный пункт **Push...** в меню **Git**/на панели инструментов\):

![push &#x432; &#x440;&#x435;&#x43F;&#x43E;&#x437;&#x438;&#x442;&#x43E;&#x440;&#x438;&#x439;](../.gitbook/assets/image%20%2882%29.png)

Слева вы видите все сохранения \(commits\), а справа файлы, которые модифицировались. Если всё в порядке, нажимайте **Push** и ожидайте конца операции**:**

![&#x423;&#x441;&#x43F;&#x435;&#x448;&#x43D;&#x44B;&#x439; push, &#x43F;&#x440;&#x438; &#x44D;&#x442;&#x43E;&#x43C; &#x431;&#x44B;&#x43B;&#x430; &#x441;&#x43E;&#x437;&#x434;&#x430;&#x43D;&#x430; &#x432;&#x435;&#x442;&#x43A;&#x430; &#x43D;&#x430; &#x441;&#x435;&#x440;&#x432;&#x435;&#x440;&#x435; origin/johnpantini \(&#x441;&#x43C;. &#x43D;&#x438;&#x436;&#x435; &#x43F;&#x440;&#x43E; origin\)](../.gitbook/assets/image%20%2880%29.png)

Теперь можно открыть репо через **Github** и убедиться, что ветка содержит новые файлы \(ветки выбираются в левой части страницы над списком файлов из выпадающего списка\):

![](../.gitbook/assets/image%20%2887%29.png)

На картинке также будет предложено сделать запрос на внесение изменений \(**Compare & pull request**\), с помощью которого можно перенести правки из ветки **johnpantini** в ветку **main**, если это потребуется.

## Получение изменений из репо

Чтобы получить актуальные правки и все обновления, вам понадобится выполнить так называемый **pull** \(Ctrl + T или аналогичный пункт **Update Project...** в меню **Git**/на панели инструментов\):

![&#x421;&#x442;&#x440;&#x430;&#x442;&#x435;&#x433;&#x438;&#x44F; &#x43F;&#x440;&#x438;&#x43D;&#x44F;&#x442;&#x438;&#x44F; &#x438;&#x437;&#x43C;&#x435;&#x43D;&#x435;&#x43D;&#x438;&#x439;](../.gitbook/assets/image%20%2888%29.png)

Первый раз **Git** попросит выбрать [стратегию для принятия правок](https://www.atlassian.com/ru/git/tutorials/merging-vs-rebasing). Ничего не меняем, только устанавливаем флаг, чтобы окно больше не появлялось.

Если вы работаете по 3-му варианту \(склонировали репо, создали проект WebStorm\), то у вас будет активная ветка **main**. Нажмите Ctrl+T, сделайте первичное обновление. Далее переключитесь на ветку **johnpantini**:

![](../.gitbook/assets/image%20%2886%29.png)

Теперь любое обновление проекта через Ctrl+T будет синхронизировать все правки на сервере с вашей локальной версией. Так вы сможете регулярно обновляться.

{% hint style="info" %}
**Local branch** - это ранее созданная локальная ветка, которая существует в вашем репо на диске, в рамках которой вы ведёте разработку.

**Remote branch** - это ветка на удалённом сервере \(**Github** в нашем случае\), на которую можно переключиться и работать, создав локальную.

**Origin** - это **краткий** псевдоним для URL репозитория на сервере **Github**.
{% endhint %}

P. S. Информация на будущее. Для того, чтобы произвести слияние двух веток, если это потребуется \(принятие изменений от другого разработчика, который работал в другой ветке\), выбирайте пункт **Merge into Current**:

![&#x421;&#x43B;&#x438;&#x44F;&#x43D;&#x438;&#x435; &#x434;&#x440;&#x443;&#x433;&#x43E;&#x439; &#x432;&#x435;&#x442;&#x43A;&#x438; &#x441; &#x442;&#x435;&#x43A;&#x443;&#x449;&#x435;&#x439; &#x430;&#x43A;&#x442;&#x438;&#x432;&#x43D;&#x43E;&#x439;](../.gitbook/assets/image%20%2876%29.png)

